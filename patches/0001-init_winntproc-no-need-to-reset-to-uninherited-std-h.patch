From 2e73677cbfe5236c9604b32ea7bfaf320f68c055 Mon Sep 17 00:00:00 2001
From: Kien Nguyen <kien.n.quang@gmail.com>
Date: Sun, 4 Aug 2024 04:29:35 -0700
Subject: [PATCH] init_winntproc: no need to reset to uninherited std handles

---
 src/w32.c    |  2 ++
 1 file changed, 2 insertions(+)

diff --git a/src/w32.c b/src/w32.c
index 31ffa301c2f..d854046af0d 100644
--- a/src/w32.c
+++ b/src/w32.c
@@ -10477,6 +10477,7 @@ init_ntproc (int dumping)
   if (getenv ("PRELOAD_WINSOCK") != NULL)
     init_winsock (TRUE);
 
+#ifndef _UCRT /* The handles should be non-inheritable already */
   /* Initial preparation for subprocess support: replace our standard
      handles with non-inheritable versions. */
   {
@@ -10535,6 +10536,7 @@ init_ntproc (int dumping)
       _open ("nul", O_TEXT | O_NOINHERIT | O_WRONLY);
     _fdopen (2, "w");
   }
+#endif
 
   /* unfortunately, atexit depends on implementation of malloc */
   /* atexit (term_ntproc); */
-- 
2.46.0.windows.1

